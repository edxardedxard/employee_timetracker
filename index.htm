<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Employee Time Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #1c1c1e;
      color: #f2f2f7;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      font-size: 1.8rem;
    }
    #container {
      display: flex;
      flex-wrap: nowrap;
      gap: 16px;
      overflow-x: auto;
      padding: 20px 0;
    }
    .calculator {
      background: #2c2c2e;
      padding: 15px;
      border-radius: 16px;
      min-width: 280px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
    }
    .calculator h3 {
      margin-top: 0;
      font-size: 1.2rem;
    }
    input[type="number"] {
      width: 70px;
      padding: 6px;
      margin-right: 4px;
      border: none;
      border-radius: 8px;
      background: #3a3a3c;
      color: #f2f2f7;
    }
    .day-entry {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
    }
    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .remove-btn {
      background: #ff453a;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 12px;
      padding: 4px 10px;
      cursor: pointer;
    }
    .export-btn {
      margin-top: 12px;
      background: #0a84ff;
      border: none;
      border-radius: 12px;
      padding: 8px;
      color: white;
      cursor: pointer;
    }
    .name-fields {
      margin-bottom: 12px;
    }
    .name-fields input {
      background: #3a3a3c;
      color: #f2f2f7;
      border: none;
      border-radius: 8px;
      padding: 8px;
      width: 100%;
      margin-bottom: 6px;
    }
    .total-display {
      margin-top: 10px;
      font-weight: bold;
    }
    #addBtn {
      background: #32d74b;
      padding: 10px 16px;
      border: none;
      border-radius: 14px;
      color: white;
      font-weight: bold;
      margin-bottom: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Employee Time Tracker</h1>
  <button id="addBtn">+ Add Employee</button>
  <div id="container"></div>

  <script>
    let counter = 0;
    const container = document.getElementById('container');

    function createEmployee(id = null, savedData = null) {
      const empId = id || 'emp_' + Date.now() + '_' + counter++;
      const div = document.createElement('div');
      div.className = 'calculator';
      div.dataset.id = empId;

      const nameFields = document.createElement('div');
      nameFields.className = 'name-fields';
      nameFields.innerHTML = `
        <input type="text" placeholder="Name" class="name" value="${savedData?.name || ''}">
        <input type="text" placeholder="Surname" class="surname" value="${savedData?.surname || ''}">
      `;

      const topRow = document.createElement('div');
      topRow.className = 'top-row';
      const title = document.createElement('h3');
      title.textContent = 'Employee';
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn';
      removeBtn.textContent = 'ðŸ—‘ Remove';
      removeBtn.onclick = () => {
        if (confirm('Remove this employee?')) {
          localStorage.removeItem(empId);
          div.remove();
        }
      };
      topRow.appendChild(title);
      topRow.appendChild(removeBtn);

      const days = document.createElement('div');
      days.className = 'days';
      for (let i = 1; i <= 31; i++) {
        const entry = document.createElement('div');
        entry.className = 'day-entry';
        entry.innerHTML = `
          <span style="width: 26px;">${i.toString().padStart(2, '0')}</span>
          <input type="number" class="hours" placeholder="h" min="0">
          <input type="number" class="minutes" placeholder="m" min="0" max="59">
        `;
        if (savedData?.days && savedData.days[i]) {
          entry.querySelector('.hours').value = savedData.days[i].h;
          entry.querySelector('.minutes').value = savedData.days[i].m;
        }
        days.appendChild(entry);
      }

      const totalDisplay = document.createElement('div');
      totalDisplay.className = 'total-display';

      function calculateTotal() {
        let total = 0;
        const entries = div.querySelectorAll('.day-entry');
        entries.forEach((e) => {
          const h = parseInt(e.querySelector('.hours').value) || 0;
          const m = parseInt(e.querySelector('.minutes').value) || 0;
          total += h * 60 + m;
        });
        totalDisplay.textContent = `Total: ${Math.floor(total / 60)}h ${total % 60}m`;
      }

      div.addEventListener('input', () => {
        calculateTotal();
        saveToStorage();
      });

      const exportBtn = document.createElement('button');
      exportBtn.className = 'export-btn';
      exportBtn.textContent = 'ðŸ“¤ Export CSV';
      exportBtn.onclick = () => {
        let csv = 'Day,Hours,Minutes\n';
        const entries = div.querySelectorAll('.day-entry');
        entries.forEach((e, i) => {
          const h = e.querySelector('.hours').value || '0';
          const m = e.querySelector('.minutes').value || '0';
          csv += `${i + 1},${h},${m}\n`;
        });
        const name = div.querySelector('.name').value || 'employee';
        const surname = div.querySelector('.surname').value || '';
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${name}_${surname}.csv`;
        a.click();
        URL.revokeObjectURL(url);
      };

      div.appendChild(topRow);
      div.appendChild(nameFields);
      div.appendChild(days);
      div.appendChild(totalDisplay);
      div.appendChild(exportBtn);
      container.appendChild(div);
      calculateTotal();
    }

    function saveToStorage() {
      document.querySelectorAll('.calculator').forEach((div) => {
        const id = div.dataset.id;
        const name = div.querySelector('.name').value;
        const surname = div.querySelector('.surname').value;
        const days = {};
        div.querySelectorAll('.day-entry').forEach((e, i) => {
          const h = parseInt(e.querySelector('.hours').value) || 0;
          const m = parseInt(e.querySelector('.minutes').value) || 0;
          if (h || m) days[i + 1] = { h, m };
        });
        localStorage.setItem(id, JSON.stringify({ name, surname, days }));
      });
    }

    document.getElementById('addBtn').onclick = () => {
      createEmployee();
    };

    // Load from localStorage
    for (let key in localStorage) {
      if (key.startsWith('emp_')) {
        try {
          const data = JSON.parse(localStorage.getItem(key));
          createEmployee(key, data);
        } catch {}
      }
    }
  </script>
</body>
</html>
